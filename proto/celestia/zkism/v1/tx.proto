syntax = "proto3";

package celestia.zkism.v1;

import "celestia/zkism/v1/types.proto";
import "cosmos/msg/v1/msg.proto";
import "cosmos_proto/cosmos.proto";
import "gogoproto/gogo.proto";

option go_package = "github.com/celestiaorg/celestia-app/x/zkism/types";

// Msg defines the zkism module Msg service.
service Msg {
  option (cosmos.msg.v1.service) = true;

  // Create a generic Comsensus ISM
  rpc CreateConsensusISM(MsgCreateConsensusISM) returns (MsgCreateConsensusISMResponse);

  // Update a generic Consensus ISM
  rpc UpdateConsensusISM(MsgUpdateConsensusISM) returns (MsgUpdateConsensusISMResponse);

  // CreateEvolveEvmISM defines the rpc method for creating a new ZK execution ISM.
  rpc CreateEvolveEvmISM(MsgCreateEvolveEvmISM) returns (MsgCreateEvolveEvmISMResponse);

  // UpdateEvolveEvmISM defines the rpc method for updating an existing ZK execution ISM.
  rpc UpdateEvolveEvmISM(MsgUpdateEvolveEvmISM) returns (MsgUpdateEvolveEvmISMResponse);

  // SubmitMessages defines the rpc method for verifying state membership of messages.
  rpc SubmitMessages(MsgSubmitMessages) returns (MsgSubmitMessagesResponse);

  // UpdateParams defines the rpc method for updating the module parameters.
  rpc UpdateParams(MsgUpdateParams) returns (MsgUpdateParamsResponse);
}

// MsgCreateConsensusISM is the request type for CreateConsensusISM
message MsgCreateConsensusISM{
  option (cosmos.msg.v1.signer) = "creator";
  // creator is the message sender.
  string creator = 1;
  // the initial trusted state that must be used to generate the first proof
  bytes trusted_state = 2;
  // the sp1 groth16 verifier key
  bytes groth16_vkey = 3;
  // hash-based commitment to the verifier key used for state transition
  bytes state_transition_vkey = 4;
}

// MsgCreateConsensusISMResponse is the response type for CreateConsensusISM
message MsgCreateConsensusISMResponse{
  bytes trusted_state = 1;
}

// MsgUpdateConsensusISM is the request type for UpdateEvolveEvmISM.
message MsgUpdateConsensusISM {
  option (cosmos.msg.v1.signer) = "signer";

  // ism identifier
  string id = 1 [
    (gogoproto.customtype) = "github.com/bcp-innovations/hyperlane-cosmos/util.HexAddress",
    (gogoproto.nullable)   = false
  ];
  // proof is the ZK proof bytes (groth16).
  bytes proof = 2;
  // the public values used for proof verification.
  bytes public_values = 3;
  // the tx signer address
  string signer = 4;
}

// MsgUpdateConsensusISMResponse is the response type for Consensus ISM.
message MsgUpdateConsensusISMResponse {
  bytes trusted_state = 1;
}

// MsgCreateEvolveEvmISM is the request type for CreateEvolveEvmISM.
message MsgCreateEvolveEvmISM {
  option (cosmos.msg.v1.signer) = "creator";
  // creator is the message sender.
  string creator = 1;
  // state commitment root of the remote chain
  bytes state_root = 2;
  // latest tracked height of the remote chain
  uint64 height = 3;
  // trusted celestia header hash
  bytes celestia_header_hash = 4;
  // trusted celestia height
  uint64 celestia_height = 5;
  // the celestia namespace identifier used by the application
  bytes namespace = 6;
  // the public key of the sequencer
  bytes sequencer_public_key = 7;
  // the sp1 groth16 verifier key
  bytes groth16_vkey = 8;
  // hash-based commitment to the verifier key used for state transition
  bytes state_transition_vkey = 9;
  // hash-based commitment to the verifier key used for state membership
  bytes state_membership_vkey = 10;
}

// MsgCreateEvolveEvmISMResponse is the response type for CreateEvolveEvmISM.
message MsgCreateEvolveEvmISMResponse {
  string id = 1 [
    (gogoproto.customtype) = "github.com/bcp-innovations/hyperlane-cosmos/util.HexAddress",
    (gogoproto.nullable)   = false
  ];
}

// MsgUpdateEvolveEvmISM is the request type for UpdateEvolveEvmISM.
message MsgUpdateEvolveEvmISM {
  option (cosmos.msg.v1.signer) = "signer";

  // ism identifier
  string id = 1 [
    (gogoproto.customtype) = "github.com/bcp-innovations/hyperlane-cosmos/util.HexAddress",
    (gogoproto.nullable)   = false
  ];
  // proof is the ZK proof bytes (groth16).
  bytes proof = 2;
  // the public values used for proof verification.
  bytes public_values = 3;
  // the tx signer address
  string signer = 4;
}

// MsgUpdateEvolveEvmISMResponse is the response type for UpdateEvolveEvmISM.
message MsgUpdateEvolveEvmISMResponse {
  // state commitment root of the remote chain
  string state_root = 1;
  // latest tracked height of the remote chain
  uint64 height = 2;
  // trusted celestia header hash
  string celestia_header_hash = 3;
  // trusted celestia height
  uint64 celestia_height = 4;
}

// MsgSubmitMessages is the request type for SubmitMessages.
message MsgSubmitMessages {
  option (cosmos.msg.v1.signer) = "signer";

  // ism identifier
  string id = 1 [
    (gogoproto.customtype) = "github.com/bcp-innovations/hyperlane-cosmos/util.HexAddress",
    (gogoproto.nullable)   = false
  ];
  // height is the EVM application height associated with the state transition update.
  uint64 height = 2;
  // proof is the ZK proof bytes (groth16).
  bytes proof = 3;
  // the public values used for proof verification.
  bytes public_values = 4;
  // the tx signer address
  string signer = 5;
}

// MsgSubmitMessagesResponse is the response type for SubmitMessages.
message MsgSubmitMessagesResponse {}

// MsgUpdateParams is the request type for UpdateParams.
message MsgUpdateParams {
  option (cosmos.msg.v1.signer) = "authority";

  // authority is the address that controls the module (defaults to x/gov unless overwritten).
  string authority = 1 [(cosmos_proto.scalar) = "cosmos.AddressString"];
  // params defines the x/zkism parameters to update.
  //
  // NOTE: All parameters must be supplied.
  Params params = 2 [(gogoproto.nullable) = false];
};

// MsgUpdateParamsResponse defines the response type for UpdateParams.
message MsgUpdateParamsResponse {};
